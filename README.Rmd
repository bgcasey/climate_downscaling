--- 
Title: Workflow for Refining ClimateNA Temperature Predictions
author: "Brendan Casey"
site: bookdown::bookdown_site
output: 
  md_document:
    variant: gfm
    toc: TRUE
    toc_depth: 2
bibliography: "4_documentation/library.bib"
#citation-style: ../../MendeleyBib/CitationStyles/nature.csl
#citation-style: https://www.zotero.org/styles/elsevier-harvard
documentclass: book
link-citations: true
github-repo: https://github.com/bgcasey/climate_downscaling
description: "This is document walks through the analyses I performed for this research."

---
Here we present our workflow and code for refining ClimateNA temperature predictions using temperature data loggers and remote sensing data accessed via Google Earth Engine.

Ecological studies often rely on interpolated climate data to predict species distributions and identify climate change refugia. However, the scale of climate data does not always correspond to the scale of habitat conditions influencing organisms. ClimateNA, a freely available software package, addresses this by providing scale-free predictions of climate variables by interpolating gridded climate data and adjusting for elevation. While useful, ClimateNA predictions could be improved by incorporating other variables that influence micro-climatic variation. We developed methods to refine ClimateNA air temperature predictions using temperature data loggers and remote sensing data accessed via Google Earth Engine. Monthly temperature variables from 2005-2021 were calculated using near-surface temperatures gathered from 513 monitoring sites across Alberta, Canada. We used variables associated with terrain, vegetation structure, and atmospheric conditions in boosted-regression trees to predict differences between ClimateNA temperature predictions and micro-climate conditions. We produced 30 m seasonal offset layers for mean, maximum, and minimum temperatures covering all of Alberta and British Columbia. Mean summer temperatures were on average -0.03°C (SD = 0.71) greater than ClimateNA predictions; maximum summer temperatures were on average 6.81°C (SD = 1.11) less than CimateNA predictions; and winter minimum temperatures were on average -0.81°C (SD = 0.98) greater than CimateNA predictions. Offset adjusted ClimateNA predictions should better reflect micro-climatic variation and improve the accuracy of species-habitat models.



```{r GlobalOptions, echo=FALSE}
options(bookdown.render.file_scope = FALSE, knitr.duplicate.label = "allow") 
knitr::opts_chunk$set(cache.path = "5_cache/")
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{r setup, include=FALSE, cache=FALSE}
#Set root directory to R project root
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{r echo=FALSE, out.width = '100%'}
library(kableExtra)
library(knitr)
```


# iButton Data

First we gathered temperature data from temperature data loggers deployed across the province of Alberta. 

```{r}
library(readxl)
iButton_sources <- read_excel("0_data/iButton_sources.xlsx")

kable(iButton_sources, position = "h!",
  align = c("l","l","r"), escape=F, caption = 'Sources of temperature data loggers included in the analysis.', booktabs=TRUE, linesep=c("", "", "", "", "\\addlinespace"))%>% 
  # column_spec(column = 3, width = "50em") %>% 
  kable_styling(latex_options="scale_down", font_size = 9)
  # kable_styling(font_size = 6, position = "center", full_width = T)

```



## Prepare data {-}

Use `1_code/r_notebooks/ibutton_data_prepare.Rmd`.

```{r child = '1_code/r_notebooks/1_ibutton_data_prepare.Rmd'}
```


## Create spatial objects {-}

Use `1_code/r_notebooks/ibutton_data_xy.Rmd`.

```{r child = '1_code/r_notebooks/2_ibutton_data_xy.Rmd'}
```


## Quality control {-}

Use `1_code/r_notebooks/3_ibutton_qualityControl.Rmd`.

```{r child = '1_code/r_notebooks/3_ibutton_qualityControl.Rmd'}
```


--- 

# ClimateNA data

Use `1_code/r_notebooks/get_climateNA.Rmd`

```{r child = '1_code/r_notebooks/4_ibutton_climateNA.Rmd'}
```


--- 

# Spatial covariates

Spatial covariates were extracted using Google Earth Engine's online code editor at [code.earthengine.google.com](http://code.earthengine.google.com/).

Download the Google Earth Engine script by using `git clone https://earthengine.googlesource.com/users/bgcasey/climate_downscaling` into your working directory. 

Use `1_code/r_notebooks/5_covariates_gee_spatial.Rmd`.

```{r child = '1_code/r_notebooks/5_covariates_gee_spatial.Rmd'}
```

--- 

# Modelling


## Boosted regression trees {-}

Use `1_code/r_notebooks/modelling_data_exploration.Rmd`.

```{r child = '1_code/r_notebooks/6_boosted_regression_trees.Rmd'}
```


## Predicted offset raster {-}

Use `1_code/r_notebooks/modelling_offset_raster.Rmd`.

```{r child = '1_code/r_notebooks/7_make_predictive_offset_raster.Rmd'}
```


## Validate {-}

Use `1_code/r_notebooks/modelling_validate_model.Rmd`.

```{r child = '1_code/r_notebooks/8_validate_model.Rmd'}
```


# References


<div id="refs"></div>




<!--chapter:end:index.Rmd-->

