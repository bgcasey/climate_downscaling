## Quality control {-}

Referred to @wood2017dtdf for quality control methods. 


```{r}
# load data
load("2_pipeline/tmp/ibuttons.rData")
```


### Identify spikes {-}

See 

```{r}
## packages
library(TSA)
library(tsoutliers)
```

### Snow burial

We defined snow burial as ibuttons with a diural range of <3 degrees for 25 consequetive days or more. [@wood2017dtdf]

```{r eval=FALSE}
load("2_pipeline/store/RIVR_dailys.rData")
d<-RIVR_dailys%>%
  filter(T_diurnal<3)%>% #filter to diurnal range <3
  filter(iBt_type=="BOT")%>%
  group_by(Site_StationKey,iBt_type)%>%
  mutate(consecutive_day_flag = if_else(Date == (lag(Date) + days(1)), 1, 0))%>% # flag consecutive days
  mutate(snow_burial=rep(rle(consecutive_day_flag)$length>=25,rle(consecutive_day_flag)$length))%>% #flag dates that are a part of >25 sequence
  filter(snow_burial==TRUE)%>%
  right_join(RIVR_dailys)%>% # join back with the original data frame
  mutate(snow_burial=replace_na(snow_burial, "FALSE"))%>%
  select(-consecutive_day_flag)%>%
  arrange(Site_StationKey, iBt_type, Date)%>%
  filter(snow_burial==TRUE)
```




